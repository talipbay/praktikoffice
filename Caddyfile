# Caddyfile for praktikoffice.kz
# Ensure ports 80 and 443 are open in your firewall

{
    # Email for Let's Encrypt notifications
    email admin@praktikoffice.kz
    
    # Use HTTP challenge (more reliable than TLS-ALPN)
    acme_ca https://acme-v02.api.letsencrypt.org/directory
}

praktikoffice.kz {
    # Enable automatic HTTPS
    encode gzip

    # Reverse proxy to Next.js app running on port 3000
    reverse_proxy localhost:3000

    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
    }

    # Logging
    log {
        output file /var/log/caddy/praktikoffice-access.log {
            roll_size 10mb
            roll_keep 5
        }
        format json
    }
}

# Redirect www to non-www
www.praktikoffice.kz {
    redir https://praktikoffice.kz{uri} permanent
}
